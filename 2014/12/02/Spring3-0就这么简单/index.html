<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Spring3.0就这么简单 | Joe&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 快速入门
spring是分层的Java SE/EE应用一站式的轻量级开源框架，以 反转控制(IOC) 和  面向切片(AOP)  为内核,提供了展现层Spring MVC, 持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术。
好的设计优于具体实现，代码应易于测试。
Spring好处：

方便解耦，简化开发
AOP编程的支持
声明式事务的支持
方便程序的测试
方便集成各种优">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring3.0就这么简单">
<meta property="og:url" content="http://yuqiao.github.io/2014/12/02/Spring3-0就这么简单/">
<meta property="og:site_name" content="Joe's Blog">
<meta property="og:description" content="1. 快速入门
spring是分层的Java SE/EE应用一站式的轻量级开源框架，以 反转控制(IOC) 和  面向切片(AOP)  为内核,提供了展现层Spring MVC, 持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术。
好的设计优于具体实现，代码应易于测试。
Spring好处：

方便解耦，简化开发
AOP编程的支持
声明式事务的支持
方便程序的测试
方便集成各种优">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring3.0就这么简单">
<meta name="twitter:description" content="1. 快速入门
spring是分层的Java SE/EE应用一站式的轻量级开源框架，以 反转控制(IOC) 和  面向切片(AOP)  为内核,提供了展现层Spring MVC, 持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术。
好的设计优于具体实现，代码应易于测试。
Spring好处：

方便解耦，简化开发
AOP编程的支持
声明式事务的支持
方便程序的测试
方便集成各种优">

  
    <link rel="alternative" href="/atom.xml" title="Joe&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Joe&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Carpe Diem</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">存档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yuqiao.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Spring3-0就这么简单" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/12/02/Spring3-0就这么简单/" class="article-date">
  <time datetime="2014-12-02T03:08:56.000Z" itemprop="datePublished">12月 2 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Spring3.0就这么简单
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-_快速入门">1. 快速入门</h1>
<p>spring是分层的Java SE/EE应用一站式的轻量级开源框架，以<strong> 反转控制(IOC) </strong>和 <strong> 面向切片(AOP) </strong> 为内核,<br>提供了展现层Spring MVC, 持久层Spring JDBC以及业务层事务管理等众多的企业级应用技术。</p>
<p>好的设计优于具体实现，代码应易于测试。</p>
<p>Spring好处：</p>
<ul>
<li>方便解耦，简化开发</li>
<li>AOP编程的支持</li>
<li>声明式事务的支持</li>
<li>方便程序的测试</li>
<li>方便集成各种优秀的框架</li>
<li>降低Java EE API的使用难度。</li>
<li>java源码是经典的学习范例。</li>
</ul>
<h3 id="Spring体系结构">Spring体系结构</h3>
<p>5个主要模块:</p>
<ol>
<li>IOC</li>
<li>AOP</li>
<li>数据访问和集成</li>
<li>web及远程操作</li>
<li>web及远程访问(Spring MVC)</li>
</ol>
<h1 id="2-_Spring_IoC容器">2. Spring IoC容器</h1>
<p>Ioc: 通过容器来控制业务对象之间的依赖关系，而非传统实现中， 由代码直接操控。</p>
<p>控制反转：控制权由应用代码中转到了外部容器。</p>
<p>优点：降低了业务对象之间的依赖程度。</p>
<p>BeanFactory是Spring框架最核心的接口，提供了高级Ioc的配置机制。<br>ApplicationContext建立在BeanFactory基础之上， 提供了更多面向应用的功能。(应用上下文）</p>
<h3 id="BeanFactory">BeanFactory</h3>
<p>spring 配置文件:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml <span class="variable">version=</span><span class="string">"1.0"</span> <span class="variable">encoding=</span><span class="string">"UTF-8"</span> ?&gt;</div><div class="line">&lt;beans <span class="variable">xmlns=</span><span class="string">"http://www.springframework.org/schema/beans"</span></div><div class="line">    xmlns:<span class="variable">xsi=</span><span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    xmlns:<span class="variable">p=</span><span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">    xsi:<span class="variable">schemaLocation=</span><span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd"&gt;</div><div class="line">   &lt;bean <span class="variable">id=</span><span class="string">"car"</span> <span class="variable">class=</span><span class="string">"com.smart.Car"</span></div><div class="line">         p:<span class="variable">brand=</span><span class="string">"红旗CA72"</span></div><div class="line">         p:<span class="variable">maxSpeed=</span><span class="string">"200"</span>/&gt;</div><div class="line">   &lt;bean <span class="variable">id=</span><span class="string">"myBeanPostProcessor"</span> <span class="variable">class=</span><span class="string">"com.smart.context.MyBeanPostProcessor"</span>/&gt;</div><div class="line">   &lt;bean <span class="variable">id=</span><span class="string">"myBeanFactoryPostProcessor"</span> <span class="variable">class=</span><span class="string">"com.smart.context.MyBeanFactoryPostProcessor"</span>/&gt;</div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>

<p>使用BeanFactory:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> BeanFactoryTest {</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) throws Throwable{</div><div class="line">       ResourcePatternResolver resolver = <span class="keyword">new</span> PathMatchingResourcePatternResolver();</div><div class="line">       Resource res = resolver.getResource(<span class="string">"classpath:com/smart/beanfactory/beans.xml"</span>);</div><div class="line">       System.<span class="keyword">out</span>.println(res.getURL());</div><div class="line">       BeanFactory bf = <span class="keyword">new</span> XmlBeanFactory(res);</div><div class="line">       System.<span class="keyword">out</span>.println(<span class="string">"init BeanFactory."</span>);</div><div class="line"></div><div class="line">       Car car = bf.getBean(<span class="string">"car"</span>,Car.class);</div><div class="line">       System.<span class="keyword">out</span>.println(<span class="string">"car bean is ready for use!"</span>);</div><div class="line">       car.introduce();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="ApplicationContext">ApplicationContext</h3>
<p>相对BeanFactory, ApplicationContext初始化比较简单:</p>
<pre><code>ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"com/smart/context/beans.xml"</span>);
</code></pre><p>还可以指定一组配置文件:</p>
<pre><code>ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> <span class="built_in">String</span>[]{<span class="string">"conf/beans1.xml"</span>,<span class="string">"conf/beans2.xml"</span>});
</code></pre><p>BeanFactory在初始化容器时，并未初始化Bean, 直到第一次访问某个Bean才实例化Bean.<br>而ApplicationContext在初始化应用上下文时就实例化所有单实例的Bean.</p>
<h3 id="WebApplicationContext">WebApplicationContext</h3>
<p>WebApplicationContext是专门为Web应用准备的，允许从Web根目录的路径中装载配置文件，完成初始化工作。</p>
<p>它需要ServletContext实例。 在web.xml中配置自启动的Servlet或Web容器监听器(ServletContextListener), 借助它们任何一个<br>完成Spring WEb应用上下文的工作。</p>
<p>配置监听器引导：</p>
<pre><code><span class="tag">&lt;<span class="title">context-param</span>&gt;</span>
    <span class="tag">&lt;<span class="title">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span>
    <span class="tag">&lt;<span class="title">param-value</span>&gt;</span>classpath:spring-config.xml<span class="tag">&lt;/<span class="title">param-value</span>&gt;</span>
<span class="tag">&lt;/<span class="title">context-param</span>&gt;</span>
<span class="tag">&lt;<span class="title">listener</span>&gt;</span>
    <span class="tag">&lt;<span class="title">listener-class</span>&gt;</span>
        org.springframework.web.context.ContextLoaderListener
    <span class="tag">&lt;/<span class="title">listener-class</span>&gt;</span>
<span class="tag">&lt;/<span class="title">listener</span>&gt;</span>
</code></pre><p>配置自启动的Servlet引导：</p>
<h3 id="集合类型属性">集合类型属性</h3>
<pre><code><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"boss1"</span> <span class="attribute">class</span>=<span class="value">"com.smart.attr.Boss"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"car"</span> <span class="attribute">ref</span>=<span class="value">"car"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"favorites"</span>&gt;</span>
        <span class="comment">&lt;!-- list&gt;
            &lt;value&gt;看报&lt;/value&gt;
            &lt;value&gt;赛车&lt;/value&gt;
            &lt;value&gt;高尔夫&lt;/value&gt;
            &lt;/list --&gt;</span>
        <span class="tag">&lt;<span class="title">set</span>&gt;</span>
            <span class="tag">&lt;<span class="title">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
            <span class="tag">&lt;<span class="title">value</span>&gt;</span>赛车<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
            <span class="tag">&lt;<span class="title">value</span>&gt;</span>高尔夫<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">set</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jobs"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">map</span>&gt;</span>
            <span class="tag">&lt;<span class="title">entry</span> &gt;</span>
                <span class="tag">&lt;<span class="title">key</span>&gt;</span> <span class="tag">&lt;<span class="title">value</span>&gt;</span>AM<span class="tag">&lt;/<span class="title">value</span>&gt;</span> <span class="tag">&lt;/<span class="title">key</span>&gt;</span>
                <span class="tag">&lt;<span class="title">value</span>&gt;</span>会见客户<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">entry</span>&gt;</span>
            <span class="tag">&lt;<span class="title">entry</span>&gt;</span>
                <span class="tag">&lt;<span class="title">key</span>&gt;</span> <span class="tag">&lt;<span class="title">value</span>&gt;</span>PM<span class="tag">&lt;/<span class="title">value</span>&gt;</span> <span class="tag">&lt;/<span class="title">key</span>&gt;</span>
                <span class="tag">&lt;<span class="title">value</span>&gt;</span>公司内部会议<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">entry</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">map</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"mails"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">props</span>&gt;</span>
            <span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"jobMail"</span>&gt;</span>john-office@baobaotao.com<span class="tag">&lt;/<span class="title">prop</span>&gt;</span>
            <span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"lifeMail"</span>&gt;</span>john-life@baobaotao.com<span class="tag">&lt;/<span class="title">prop</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">props</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"jobTime"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">map</span>&gt;</span>
            <span class="tag">&lt;<span class="title">entry</span>&gt;</span>
                <span class="tag">&lt;<span class="title">key</span>&gt;</span> <span class="tag">&lt;<span class="title">value</span>&gt;</span>会见客户<span class="tag">&lt;/<span class="title">value</span>&gt;</span> <span class="tag">&lt;/<span class="title">key</span>&gt;</span>
                <span class="tag">&lt;<span class="title">value</span>&gt;</span>124<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">entry</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">map</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
<span class="tag">&lt;/<span class="title">bean</span>&gt;</span>
</code></pre><p>对应Boss类：</p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> Boss {
    <span class="keyword">private</span> String name ;
    <span class="keyword">private</span> <span class="keyword">int</span> age;
    <span class="keyword">private</span> Car car = <span class="keyword">new</span> Car();
    <span class="keyword">private</span> Map jobs = <span class="keyword">new</span> HashMap();
    <span class="keyword">private</span> Properties mails = <span class="keyword">new</span> Properties();
    <span class="keyword">private</span> Map&lt;String,Integer&gt; jobTime = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();
    <span class="keyword">public</span> String <span class="title">getName</span>() {
        <span class="keyword">return</span> name;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(String name) {
        <span class="keyword">this</span>.name = name;
    }

    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span>() {
        <span class="keyword">return</span> age;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span>(<span class="keyword">int</span> age) {
        <span class="keyword">this</span>.age = age;
    }
    <span class="keyword">public</span> Map&lt;String, Integer&gt; <span class="title">getJobTime</span>() {
        <span class="keyword">return</span> jobTime;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJobTime</span>(Map&lt;String, Integer&gt; jobTime) {
        <span class="keyword">this</span>.jobTime = jobTime;
    }
    <span class="keyword">public</span> Properties <span class="title">getMails</span>() {
        <span class="keyword">return</span> mails;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMails</span>(Properties mails) {
        <span class="keyword">this</span>.mails = mails;
    }
    <span class="keyword">public</span> Map <span class="title">getJobs</span>() {
        <span class="keyword">return</span> jobs;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJobs</span>(Map jobs) {
        <span class="keyword">this</span>.jobs = jobs;
    }
<span class="comment">//  private List favorites = new ArrayList();</span>
<span class="comment">//</span>
<span class="comment">//  public List getFavorites() {</span>
<span class="comment">//      return favorites;</span>
<span class="comment">//  }</span>
<span class="comment">//  public void setFavorites(List favorites) {</span>
<span class="comment">//      this.favorites = favorites;</span>
<span class="comment">//  }</span>
    <span class="keyword">private</span> Set favorites = <span class="keyword">new</span> HashSet();
    <span class="keyword">public</span> Car <span class="title">getCar</span>() {
        <span class="keyword">return</span> car;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCar</span>(Car car) {
        <span class="keyword">this</span>.car = car;
    }
    <span class="keyword">public</span> String <span class="title">toString</span>(){
        String temp =<span class="string">"car:"</span>+car+<span class="string">"\n"</span>;
        temp += <span class="string">"favorites.size:"</span>+favorites.size()+<span class="string">"\n"</span>;
        temp += <span class="string">"jobs.size:"</span>+jobs.size();
        <span class="keyword">return</span> temp;
    }
    <span class="keyword">public</span> Set <span class="title">getFavorites</span>() {
        <span class="keyword">return</span> favorites;
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFavorites</span>(Set favorites) {
        <span class="keyword">this</span>.favorites = favorites;
    }
}
</code></pre><h3 id="配置集合类型的Bean">配置集合类型的Bean</h3>
<pre><code><span class="tag">&lt;<span class="title">util:list</span> <span class="attribute">id</span>=<span class="value">"favoriteList1"</span> <span class="attribute">list-class</span>=<span class="value">"java.util.LinkedList"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>赛车<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>高尔夫<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
<span class="tag">&lt;/<span class="title">util:list</span>&gt;</span>

<span class="tag">&lt;<span class="title">util:set</span> <span class="attribute">id</span>=<span class="value">"favoriteSet1"</span>  &gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>看报<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>赛车<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
    <span class="tag">&lt;<span class="title">value</span>&gt;</span>高尔夫<span class="tag">&lt;/<span class="title">value</span>&gt;</span>
<span class="tag">&lt;/<span class="title">util:set</span>&gt;</span>

<span class="tag">&lt;<span class="title">util:map</span> <span class="attribute">id</span>=<span class="value">"emails1"</span> &gt;</span>
    <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"AM"</span> <span class="attribute">value</span>=<span class="value">"会见客户"</span> /&gt;</span>
    <span class="tag">&lt;<span class="title">entry</span> <span class="attribute">key</span>=<span class="value">"PM"</span> <span class="attribute">value</span>=<span class="value">"公司内部会议"</span> /&gt;</span>
<span class="tag">&lt;/<span class="title">util:map</span>&gt;</span>

<span class="tag">&lt;<span class="title">util:properties</span> <span class="attribute">id</span>=<span class="value">"emailProps1"</span>
<span class="attribute">location</span>=<span class="value">"classpath:com/smart/fb/mails.properties"</span> /&gt;</span>
</code></pre><h3 id="自动装配">自动装配</h3>
<p><bean>元素提供自动装配的属性：autowire=”&lt;自动装配类型&gt;”</bean></p>
<p>4种自动装配类型：</p>
<ul>
<li>byName</li>
<li>byType</li>
<li>constructor</li>
<li>autodetect</li>
</ul>
<p><beans>元素标签中的default-autowire属性可以配置全局自动装配。</beans></p>
<h3 id="Bean作用域">Bean作用域</h3>
<ol>
<li>singleton</li>
<li>prototype</li>
<li>request</li>
<li>session</li>
<li>globalSession</li>
</ol>
<h3 id="基于注解的配置">基于注解的配置</h3>
<ul>
<li>@Component</li>
<li>@Repository: 用于对DAO实现类进行标注</li>
<li>@Service: 用于对Service实现类进行标注</li>
<li>@Controller: 用于对Controller实现类进行标注</li>
</ul>
<p>使用注解配置信息启动Spring容器：</p>
<pre><code>&lt;<span class="keyword">context</span>:<span class="keyword">component</span>-scan base-<span class="keyword">package</span>=<span class="string">"com.yuqiao.hellomvc.dao"</span>/&gt;
&lt;<span class="keyword">context</span>:<span class="keyword">component</span>-scan base-<span class="keyword">package</span>=<span class="string">"com.yuqiao.hellomvc.dao"</span> resorce-pattern=<span class="string">"anno/*.class"</span>/&gt;
</code></pre><p>默认情况下, resorce-pattern=”<em>*/</em>.class”</p>
<p>Spring通过@Autowired注解实现Bean的依赖注入。<br>若容器没有一个和标注变量类型匹配的Bean， Spring容器启动时讲抛出NoSuchBeanDefinitionException异常，<br>若希望不抛出该异常，那么就可以使用@Autowired(require=false)进行标注。</p>
<p>使用@Qualifier指定注入Bean名称。</p>
<h1 id="3-_Spring_AOP">3. Spring AOP</h1>
<h2 id="aop_概述">aop 概述</h2>
<p>aop应用场景受限, 一般只适用于那些具有横切逻辑的应用场景：性能监测，访问控制， 事务管理及日志记录。</p>
<h3 id="aop术语">aop术语</h3>
<ul>
<li>连接点(JoinPoint)</li>
<li>切点(PointCut)</li>
<li>增强(Advice)</li>
<li>目标对象(Target)</li>
<li>引介(introduce)</li>
<li>织入(Weaving)</li>
<li>代理(Proxy)</li>
<li>切面(Aspect) </li>
</ul>
<h2 id="创建增强类">创建增强类</h2>
<p>Spring支持5种类型的增强:</p>
<ul>
<li>前置增强(org.springframework.aop.BeforeAdvice)</li>
<li>后置增强(org.springframework.aop.AfterReturningAdvice)</li>
<li>环绕增强(org.springframework.intercept.MethodInterceptor)</li>
<li>异常抛出增强(org.springframework.aop.ThrowsAdvice)</li>
<li>引介增强(org.springframework.aop.INtroductionInterceptor)</li>
</ul>
<h2 id="创建切面">创建切面</h2>
<p>支持两种方法配置器:</p>
<ul>
<li>静态方法配置器</li>
<li>动态方法配置器</li>
</ul>
<h3 id="切点类型">切点类型</h3>
<ul>
<li>静态方法切点</li>
<li>动态方法切点</li>
<li>注解切点</li>
<li>表达式切点</li>
<li>流程切点</li>
<li>复合切点</li>
</ul>
<h3 id="切面类型">切面类型</h3>
<ul>
<li>Advisor(一般切面)</li>
<li>PointcutAdvisor(切点切面)</li>
<li>IntroductionAdvisor(引介切面)</li>
</ul>
<h3 id="静态普通方法名匹配切面">静态普通方法名匹配切面</h3>
<p>在Waiter#greetTo()织入增强，切面类实现：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingAdvisor</span> <span class="keyword">extends</span> <span class="title">StaticMethodMatcherPointcutAdvisor</span> </span>{</div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span>(Method method, Class&lt;?&gt; targetClass) {</div><div class="line">        <span class="keyword">return</span> <span class="string">"greetTo"</span>.equals(method.getName());</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="annotation">@Override</span></div><div class="line">    <span class="keyword">public</span> ClassFilter <span class="title">getClassFilter</span>() {</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClassFilter() {</div><div class="line">            <span class="annotation">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span>(Class&lt;?&gt; clazz) {</div><div class="line">                <span class="keyword">return</span> Waiter.class.isAssignableFrom(clazz);</div><div class="line">            }</div><div class="line">        };</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>配置切面:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=<span class="string">"greetingAdvisor"</span> class=<span class="string">"com.yuqiao.advice.GreetingAdvisor"</span></div><div class="line">        p:advice-<span class="keyword">ref</span>=<span class="string">"greetingBeforeAdvice"</span>/&gt;</div><div class="line">&lt;bean id=<span class="string">"parent"</span> abstract=<span class="string">"true"</span></div><div class="line">        class=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span></div><div class="line">        p:interceptorNames=<span class="string">"greetingAdvisor"</span></div><div class="line">        p:proxyTargetClass=<span class="string">"true"</span>/&gt;</div><div class="line">&lt;bean id=<span class="string">"waiter2"</span> parent=<span class="string">"parent"</span> p:target-<span class="keyword">ref</span>=<span class="string">"nativeWaiter"</span>/&gt;</div><div class="line">&lt;bean id=<span class="string">"seller1"</span> parent=<span class="string">"parent"</span> p:target-<span class="keyword">ref</span>=<span class="string">"seller"</span>/&gt;</div></pre></td></tr></table></figure>

<h3 id="静态正则表达式方法匹配切面">静态正则表达式方法匹配切面</h3>
<p>为seller定义切面：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=<span class="string">"regexAdvisor"</span> class=<span class="string">"org.springframework.aop.support.RegexpMethodPointcutAdvisor"</span></div><div class="line">        p:advice-<span class="keyword">ref</span>=<span class="string">"greetingBeforeAdvice"</span>&gt;</div><div class="line">    &lt;property name=<span class="string">"patterns"</span>&gt;</div><div class="line">        &lt;list&gt;</div><div class="line">            &lt;value&gt;.*greet.*&lt;/value&gt;</div><div class="line">        &lt;/list&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;bean id=<span class="string">"seller2"</span> class=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span></div><div class="line">        p:interceptorNames=<span class="string">"regexAdvisor"</span></div><div class="line">        p:target-<span class="keyword">ref</span>=<span class="string">"seller"</span></div><div class="line">        p:proxyTargetClass=<span class="string">"true"</span>/&gt;&lt;ap</div></pre></td></tr></table></figure>

<h2 id="自动创建代理">自动创建代理</h2>
<p>前面都是使用ProxyFactoryBean创建织入切面的代理， 每个bean都需要该配置， 比较麻烦。</p>
<p>spring提供了自动代理机制。 使用BeanPostProcessor， 根据一定规则自动在容器实例化Bean时为匹配的Bean生成代理实例. 分类：</p>
<ul>
<li>基于Bean配置名规则的自动代理创建器。实现类为BeanNameAutoProxyCreator.</li>
<li>基于Advisor陪陪机制。DefaultAdvisorAutoProxyCreator.</li>
<li>基于Bean中AspectJ注解标签的自动代理创建器。</li>
</ul>
<h3 id="BeanNameAutoProxyCreator">BeanNameAutoProxyCreator</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;bean <span class="variable">class=</span><span class="string">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span></div><div class="line">        p:<span class="variable">beanNames=</span><span class="string">"*er"</span></div><div class="line">        p:<span class="variable">interceptorNames=</span><span class="string">"greetingBeforeAdvice"</span></div><div class="line">        p:<span class="variable">optimize=</span><span class="string">"true"</span>/&gt;</div></pre></td></tr></table></figure>

<h3 id="DefaultAdvisorAutoProxyCreator">DefaultAdvisorAutoProxyCreator</h3>
<pre><code>&lt;bean <span class="keyword">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;
</code></pre><h2 id="基于@AspectJ配置切面">基于@AspectJ配置切面</h2>
<h3 id="@AspectJ语法基础">@AspectJ语法基础</h3>
<p>Spring支持9个@AspectJ切点表达函数</p>
<ul>
<li>execution()</li>
<li>@annotation()</li>
<li>args()</li>
<li>@args()</li>
<li>within()</li>
<li>target()</li>
<li>@within()</li>
</ul>
<h1 id="4-_使用Spring_JDBC访问数据库">4. 使用Spring JDBC访问数据库</h1>
<p>由于JDBC api过于底层，开发者不但要编写数据操作代码，还需要编写JDBC连接，处理异常，释放资源等的代码。</p>
<p>Spring JDBC通过模板和回调机制大大降低了JDBC的复杂度。</p>
<p>创建一张表:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">DriverManagerDataSource <span class="keyword">ds</span> = <span class="keyword">new</span> DriverManagerDataSource();</div><div class="line"><span class="keyword">ds</span>.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line"><span class="keyword">ds</span>.setUrl(<span class="string">"jdbc:mysql://localhost:3306/sampledb"</span>);</div><div class="line"><span class="keyword">ds</span>.setUsername(<span class="string">"root"</span>);</div><div class="line"></div><div class="line">JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</div><div class="line">jdbcTemplate.setDataSource(<span class="keyword">ds</span>);</div><div class="line"></div><div class="line">String sql = <span class="string">"create table t_user(user_id int primary key, user_name varchar(60))"</span>;</div><div class="line">jdbcTemplate.<span class="keyword">execute</span>(sql);</div></pre></td></tr></table></figure>

<p>一般情况下，在DAO类中使用JdbcTemplate, 在XML配置文件中配置好JdbcTemplate,然后直接在DAO中注入即可。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.yuqiao.hellomvc.dao;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line"><span class="annotation">@Repository</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginLogDao</span> </span>{</div><div class="line">    <span class="annotation">@Autowired</span></div><div class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertLoginLog</span>(LoginLog loginLog) {</div><div class="line">        String sqlStr = <span class="string">"INSERT INTO t_login_log(user_id,ip,login_datetime) "</span></div><div class="line">                + <span class="string">"VALUES(?,?,?)"</span>;</div><div class="line">        Object[] args = {loginLog.getUserId(), loginLog.getIp(),</div><div class="line">                loginLog.getLoginDate()};</div><div class="line">        jdbcTemplate.update(sqlStr, args);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>在Spring配置文件定义jdbcTemplate:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=<span class="string">"dataSource"</span> class=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span></div><div class="line">      destroy-<span class="keyword">method</span>=<span class="string">"close"</span></div><div class="line">      p:driverClassName=<span class="string">"com.mysql.jdbc.Driver"</span></div><div class="line">      p:url=<span class="string">"jdbc:mysql://localhost:3306/sampledb31"</span></div><div class="line">      p:username=<span class="string">"root"</span></div><div class="line">      p:password=<span class="string">""</span>/&gt;</div><div class="line"></div><div class="line">&lt;bean id=<span class="string">"jdbcTemplate"</span> class=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span></div><div class="line">      p:dataSource-<span class="keyword">ref</span>=<span class="string">"dataSource"</span>/&gt;</div></pre></td></tr></table></figure>

<p>配置一般分为4个步骤:</p>
<ol>
<li><p>定义DataSource.</p>
</li>
<li><p>定义JdbcTemplate. 可以控制JDBC api的属性.</p>
<ul>
<li>queryTimeout. 查询数据的最大超时时间。</li>
<li>fetchSize. ResultSet每次返回的行数.</li>
<li>maxRows:</li>
<li>ignoreWarnings:</li>
</ul>
</li>
<li><p>声明一个抽象的<bean>，以便所有DAO复用配置。</bean></p>
</li>
<li><p>配置具体的DAO.</p>
</li>
</ol>
<h2 id="基本的数据操作">基本的数据操作</h2>
<h3 id="返回数据库的表自增主键值">返回数据库的表自增主键值</h3>
<p>KeyHolder是一个回调接口，Spring用他保存新增记录对应的主键。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewSpace</span>(<span class="keyword">final</span> ViewSpace viewSpace){</div><div class="line">    <span class="keyword">final</span> String sql = <span class="string">"INSERT INTO t_view_space (space_name, description, address, user_id) VALUES(?,?,?,?)"</span>;</div><div class="line">    KeyHolder keyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</div><div class="line">    jdbcTemplate.update(<span class="keyword">new</span> PreparedStatementCreator() {</div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> PreparedStatement <span class="title">createPreparedStatement</span>(Connection connection) <span class="keyword">throws</span> SQLException {</div><div class="line">            PreparedStatement ps = connection.prepareStatement(sql);</div><div class="line">            ps.setString(<span class="number">1</span>, viewSpace.getSpaceName());</div><div class="line">            ps.setString(<span class="number">2</span>, viewSpace.getDescription());</div><div class="line">            ps.setString(<span class="number">3</span>, viewSpace.getAddress());</div><div class="line">            ps.setInt(<span class="number">4</span>, viewSpace.getUser());</div><div class="line">            <span class="keyword">return</span> ps;</div><div class="line">        }</div><div class="line">    },keyHolder);</div><div class="line">    viewSpace.setSpaceId(keyHolder.getKey().intValue());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>在jdbc3.0之前， PreparedStatement不能绑定主键。用户必须在插入数据库后马上执行另一条获取新增主键的查询语句。<br>mysql: SELECT LAST_INSERT_ID();</p>
<h3 id="批量更改数据">批量更改数据</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewSpaces</span>(<span class="keyword">final</span> List&lt;ViewSpace&gt; viewSpaceList){</div><div class="line">    <span class="keyword">final</span> String sql = <span class="string">"INSERT INTO t_view_space (space_name, description, address, user_id) VALUES(?,?,?,?)"</span>;</div><div class="line">    jdbcTemplate.batchUpdate(sql, <span class="keyword">new</span> BatchPreparedStatementSetter() {</div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span>(PreparedStatement ps, <span class="keyword">int</span> i) <span class="keyword">throws</span> SQLException {</div><div class="line">            ViewSpace viewSpace = viewSpaceList.get(i);</div><div class="line">            ps.setString(<span class="number">1</span>, viewSpace.getSpaceName());</div><div class="line">            ps.setString(<span class="number">2</span>, viewSpace.getDescription());</div><div class="line">            ps.setString(<span class="number">3</span>, viewSpace.getAddress());</div><div class="line">            ps.setInt(<span class="number">4</span>, viewSpace.getUser());</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBatchSize</span>() {</div><div class="line">            <span class="keyword">return</span> viewSpaceList.size();</div><div class="line">        }</div><div class="line">    });</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="查询数据">查询数据</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> ViewSpace <span class="title">getViewSpace</span>(<span class="keyword">final</span> <span class="keyword">int</span> id){</div><div class="line">    <span class="keyword">final</span> String sql = <span class="string">"SELECT space_name, description, address, user_id from t_view_space where space_id=?"</span>;</div><div class="line">    <span class="keyword">final</span> ViewSpace vs = <span class="keyword">new</span> ViewSpace();</div><div class="line">    jdbcTemplate.query(sql, <span class="keyword">new</span> Object[]{id}, <span class="keyword">new</span> RowCallbackHandler() {</div><div class="line">        <span class="annotation">@Override</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processRow</span>(ResultSet resultSet) <span class="keyword">throws</span> SQLException {</div><div class="line">            vs.setSpaceId(id);</div><div class="line">            vs.setSpaceName(resultSet.getString(<span class="string">"space_name"</span>));</div><div class="line">            vs.setDescription(resultSet.getString(<span class="string">"description"</span>));</div><div class="line">            vs.setAddress(resultSet.getString(<span class="string">"address"</span>));</div><div class="line">            vs.setUser(resultSet.getInt(<span class="string">"user_id"</span>));</div><div class="line">        }</div><div class="line">    });</div><div class="line">    <span class="keyword">return</span> vs;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>RowCallbackHandler 和RowMapper<t>比较。</t></p>
<p>单值查询接口：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewSpaceNum</span>(){</div><div class="line">    String sql = <span class="string">"select COUNT(*) FROM  t_view_space"</span>;</div><div class="line">    <span class="keyword">return</span> jdbcTemplate.queryForInt(sql);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>编写sql语句时，用大写方式编写SQL的关键字和函数， 用小写的形式编写表名，字段名等非语义的元素。</p>
<p>调用存储过程： execute</p>
<h2 id="BLOB/CLOB类型数据的操作">BLOB/CLOB类型数据的操作</h2>
<h1 id="5-_集成Hibernate">5. 集成Hibernate</h1>
<h1 id="6-_Spring的事务管理">6. Spring的事务管理</h1>
<h2 id="数据库事务基础知识">数据库事务基础知识</h2>
<p>一荣俱荣，一损俱损。体现事务的思想，很多复杂的事务要分步进行，但他们组成一个整体，要么整体生效，要么整体失效。</p>
<p>数据库事务需要满足4个特性（ACID):原子性(Atomic), 一致性(Consistency), 隔离性(Isolation)和持久性(Durability).</p>
<p>一致性是目标，其它都是达到这个目标的措施或者手段。</p>
<p>数据库系统一般采用重执行日志保证原子性，一致性和持久性。重执行日志记录了数据库变化的每一个动作，数据库在一个事务中执行一部分操作后发生错误退出，数据库即可根据重执行日志车险已经执行的操作。<br>数据库管理系统采用数据库锁机制保证事务的隔离性。</p>
<p>Connection#getMetaData()获取DatbaMataData对象，该对象的supportsTransactions(), supportsTransactionIsolationLevel(int level)查看底层数据库的事务支持情况。</p>
<h3 id="Jdbc对事务的处理">Jdbc对事务的处理</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="type">Connection</span> conn;</div><div class="line"><span class="keyword">try</span>{</div><div class="line">    conn = <span class="type">DriverManager</span>.getConnection();</div><div class="line">    conn.setAutoCommit(<span class="literal">false</span>);</div><div class="line">    conn.setTransactionIsolation(<span class="type">Connection</span>.<span class="type">TRANSACTION_SERIALIZABLE</span>);</div><div class="line">    <span class="type">Statement</span> <span class="type">stmt</span> = conn.createStatement();</div><div class="line">    <span class="type">int</span> rows = <span class="type">stmt</span>.executeUpdate(<span class="string">"INSERT INTO t_viewspace VALUES(1,'XXXX')"</span>);</div><div class="line">    rows = <span class="type">stmt</span>.executeUpdate(<span class="string">"UPDATE t_viewpoint set ticket = ticket +10"</span>);</div><div class="line">    conn.commit();</div><div class="line">}catch (<span class="type">Exception</span> e){</div><div class="line">    conn.rollback();</div><div class="line">}<span class="keyword">finally</span> {</div><div class="line">}</div></pre></td></tr></table></figure>

<h2 id="Spring对事务管理的处理">Spring对事务管理的处理</h2>
<p>Spring为事务管理提供了一致的编程模板, 在高层次建立了同意的事务抽象。提供了TransactionTemplate。</p>
<p>Spring事务管理的亮点在于声明式事务管理。</p>
<h3 id="事务管理关键抽象">事务管理关键抽象</h3>
<p>Spring事务管理SPI(Service Provider Interface)的抽象层主要包括三个接口：</p>
<ul>
<li><p>PlatformTransactionManager: 根据TransactionDefinition提供的事务属性配置信息，创建事务，并用TransationStatus描述这个激活事务的状态。定义了3方法:</p>
<ul>
<li>getTransaction(definition)</li>
<li>commit(stutus)</li>
<li>rollback(status)</li>
</ul>
</li>
<li><p>TransactionDefinition: 描述事务的隔离级别，超时时间，是否为只读事务和事务传播规则等控制事务具体行为的事务属性。</p>
</li>
<li>TransactionStatus: 代表一个事务的具体运行状态。</li>
</ul>
<h3 id="事务管理实现类">事务管理实现类</h3>
<p>Spring将事务管理委托给底层具体的持久化实现框架完成。</p>
<p>Spring JDBC和iBatis都是基于数据源的Connection访问数据库，所以可以使用DataSourceTransactionManager.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=<span class="string">"dataSource"</span></div><div class="line">        class=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span></div><div class="line">        destroy-<span class="keyword">method</span>=<span class="string">"close"</span></div><div class="line">        p:driverClassName=<span class="string">"${jdbc.driverClassName}"</span></div><div class="line">        p:url=<span class="string">"${jdbc.url}"</span></div><div class="line">        p:username=<span class="string">"${jdbc.username}"</span></div><div class="line">        p:password=<span class="string">"${jdbc.password}"</span>/&gt;</div><div class="line">&lt;bean id=<span class="string">"txManager"</span></div><div class="line">        class=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></div><div class="line">        p:dataSource-<span class="keyword">ref</span>=<span class="string">"dataSource"</span>/&gt;</div></pre></td></tr></table></figure>

<h3 id="事务同步管理器">事务同步管理器</h3>
<p>Spring将JDBC的Connection,Hibernate的Session等访问数据库的连接或会话对象统称为资源。资源在同一时刻是不能多线程共享的。<br>为了让Dao,Service类可能做到singleton，Spring的事务同步管理类TransactionSynchronizationManager使用ThreadLocal管理为不同事务线程提供了<br>独立的资源副本。</p>
<p>Spring框架为不同的持久化技术提供了一套从TransactionSynchronizationManager中获取对应线程绑定资源的工具类。<br>DataSourceUtils.getConnection可以从指定的数据源中获取和当前线程绑定的Connection.</p>
<h3 id="事务传播行为">事务传播行为</h3>
<h2 id="编程式的事务管理">编程式的事务管理</h2>
<p>很少用。 Spring提供了TransactionTemplate.</p>
<h2 id="使用xml配置声明式事务">使用xml配置声明式事务</h2>
<p>Spring的声明式事务管理是通过Spring AOP实现的，通过事务的声明性信息，Spring负责将事务管理增强逻辑动态织入业务方法相应连接点中。<br>这些逻辑包括获取线程绑定资源，开始事务，提交/回滚事务，进行异常转换和处理工作。</p>
<h3 id="一个被实施事务增强的服务接口">一个被实施事务增强的服务接口</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">interface</span> IViewSpace {</div><div class="line">    <span class="keyword">void</span> addViewSpace(ViewSpace space);</div><div class="line">    <span class="keyword">void</span> updateViewSpace(ViewSpace space);</div><div class="line">    ViewSpace getViewSpace(<span class="keyword">int</span> spaceId);</div><div class="line">    <span class="keyword">int</span> getViewSpaceNum();</div><div class="line">    <span class="keyword">void</span> deleteViewSpace(<span class="keyword">int</span> spaceId);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>我们希望对addViewSpace和updateViewSpace拥有写事务的能力， 而另外两个拥有读事务的能力。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Transactional</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewSpaceImpl</span> <span class="keyword">implements</span> <span class="title">IViewSpace</span> </span>{</div><div class="line">    <span class="keyword">private</span> ViewSpaceDao viewSpaceDao;</div><div class="line">    <span class="keyword">private</span> ViewPointDao viewPointDao;</div><div class="line"></div><div class="line">    <span class="annotation">@Transactional</span>(readOnly=<span class="keyword">true</span>)</div><div class="line">    <span class="keyword">public</span> ViewSpace <span class="title">getViewSpace</span>(<span class="keyword">int</span> spaceId) {</div><div class="line">        <span class="keyword">return</span> viewSpaceDao.getViewSpace( spaceId);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateViewSpace</span>(ViewSpace viewSpace) {</div><div class="line">        viewSpaceDao.updateViewSpace(viewSpace);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewSpaceNum</span>() {</div><div class="line">        <span class="keyword">return</span> viewSpaceDao.getViewSpaceNum();</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setViewSpaceDao</span>(ViewSpaceDao viewSpaceDao) {</div><div class="line">        <span class="keyword">this</span>.viewSpaceDao = viewSpaceDao;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setViewPointDao</span>(ViewPointDao viewPointDao) {</div><div class="line">        <span class="keyword">this</span>.viewPointDao = viewPointDao;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewSpace</span>(ViewSpace space) {</div><div class="line">        <span class="keyword">this</span>.viewSpaceDao.addViewSpace(space);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteViewSpace</span>(<span class="keyword">int</span> spaceId) {</div><div class="line">        <span class="keyword">this</span>.viewSpaceDao.deleteViewSpace(spaceId);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>ViewSpaceImpl是一个POJO, 只是简单使用持久层的多个DAO类。</p>
<h3 id="使用原始的TransactionProxyFactoryBean">使用原始的TransactionProxyFactoryBean</h3>
<p>了解TransactionProxyFactoryBean有助于跟直观</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--1. 引入dao和DataSource的配置文件--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">import</span> <span class="attribute">resource</span>=<span class="value">"classpath:applicationContext-dao.xml"</span> /&gt;</span></div><div class="line"><span class="comment">&lt;!--2. 声明事务管理器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"txManager"</span></span></div><div class="line">    <span class="attribute">class</span>=<span class="value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"dataSource"</span> <span class="attribute">ref</span>=<span class="value">"dataSource"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--3. 需要实施事务增强的目标业务bean--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"viewSpaceTarget"</span></span></div><div class="line">        <span class="attribute">class</span>=<span class="value">"com.smart.service.impl.ViewSpaceImpl"</span></div><div class="line">        <span class="attribute">p:viewSpaceDao-ref</span>=<span class="value">"viewSpaceDao"</span></div><div class="line">        <span class="attribute">p:viewPointDao-ref</span>=<span class="value">"viewPointDao"</span>/&gt;</div><div class="line"><span class="comment">&lt;!--4. 使用事务代理工程类为目标业务Bean提供事务增强--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"viewSpaceService"</span></span></div><div class="line">    <span class="attribute">class</span>=<span class="value">"org.springframework.transaction.interceptor.TransactionProxyFactoryBean"</span></div><div class="line">    <span class="attribute">p:transactionManager-ref</span>=<span class="value">"txManager"</span></div><div class="line">    <span class="attribute">p:target-ref</span>=<span class="value">"viewSpaceTarget"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"transactionAttributes"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="title">props</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"get*"</span>&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="title">prop</span> <span class="attribute">key</span>=<span class="value">"*"</span>&gt;</span>PROPAGATION_REQUIRED<span class="tag">&lt;/<span class="title">prop</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="title">props</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">bean</span>&gt;</span></div></pre></td></tr></table></figure>

<p>异常回滚/提交规则</p>
<p><prop>内的值为事务属性配置信息， 格式如下：</prop></p>
<pre><code>PROPAGATION_REQUIRED, ISOLATION, readOnly, -<span class="keyword">Exception</span>, +<span class="keyword">Exception</span>
</code></pre><h3 id="基于tx/aop命名空间的配置">基于tx/aop命名空间的配置</h3>
<p>Spring基于Schema的配置中,添加了一个tx命名空间， 在配置文件中医明确结构化的方式定义事务属性，<br>大大提高配置事务属性的便利性。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">import</span> resource=<span class="string">"classpath:applicationContext-dao.xml"</span> /&gt;</div><div class="line">&lt;!--①不再需要为了事务<span class="type">AOP</span>增强的实施而改名换姓--&gt;</div><div class="line">&lt;bean id=<span class="string">"viewSpaceService"</span></div><div class="line">    class=<span class="string">"com.smart.service.impl.ViewSpaceImpl"</span></div><div class="line">    p:viewSpaceDao-<span class="keyword">ref</span>=<span class="string">"viewSpaceDao"</span></div><div class="line">    p:viewPointDao-<span class="keyword">ref</span>=<span class="string">"viewPointDao"</span>/&gt;</div><div class="line"></div><div class="line">&lt;!--<span class="number">2</span>. 事务管理器--&gt;</div><div class="line">&lt;bean id=<span class="string">"txManager"</span></div><div class="line">    class=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></div><div class="line">    p:dataSource-<span class="keyword">ref</span>=<span class="string">"dataSource"</span>/&gt;</div><div class="line"></div><div class="line">&lt;aop:config&gt;</div><div class="line">    &lt;!--③-<span class="number">1</span>通过aop定义事务增强切面--&gt;</div><div class="line">    &lt;aop:pointcut id=<span class="string">"serviceMethod"</span></div><div class="line">                    expression=<span class="string">"execution(* com.smart.service.*Service.*(..))"</span> /&gt;</div><div class="line">    &lt;!--③-<span class="number">2</span>引用事务增强--&gt;</div><div class="line">    &lt;aop:advisor pointcut-<span class="keyword">ref</span>=<span class="string">"serviceMethod"</span> advice-<span class="keyword">ref</span>=<span class="string">"txAdvice"</span> /&gt;</div><div class="line">&lt;/aop:config&gt;</div><div class="line"></div><div class="line">&lt;!--④事务增强--&gt;</div><div class="line">&lt;tx:advice id=<span class="string">"txAdvice"</span> transaction-manager=<span class="string">"txManager"</span>&gt;</div><div class="line">    &lt;!--④-<span class="number">1</span>事务属性定义--&gt;</div><div class="line">    &lt;tx:attributes&gt;</div><div class="line">        &lt;tx:<span class="keyword">method</span> name=<span class="string">"get*"</span> read-only=<span class="string">"false"</span>/&gt;</div><div class="line">        &lt;tx:<span class="keyword">method</span> name=<span class="string">"add*"</span> rollback-<span class="keyword">for</span>=<span class="string">"Exception"</span> /&gt;</div><div class="line">        &lt;tx:<span class="keyword">method</span> name=<span class="string">"update*"</span>/&gt;</div><div class="line">    &lt;/tx:attributes&gt;</div><div class="line">&lt;/tx:advice&gt;</div></pre></td></tr></table></figure>

<p><tx:method> 元素：</tx:method></p>
<ul>
<li>name</li>
<li>progagation</li>
<li>isolation</li>
<li>timeout</li>
<li>read-only</li>
<li>rollback-for</li>
<li>no-rollback-for</li>
</ul>
<h2 id="使用注解配置声明式事务">使用注解配置声明式事务</h2>
<h1 id="7-_Spring_MVC">7. Spring MVC</h1>
<h2 id="概述">概述</h2>
<p>围绕DispatcherServlet核心展开，DispatcherServlet是Spring MVC的总导演，总策划，它负责截获请求并将其分派给相应的处理器处理。</p>
<p>Spring MVC 包括:</p>
<ul>
<li>注解控制器</li>
<li>请求及响应的相信处理</li>
<li>视图解析</li>
<li>本地化解析</li>
<li>删除文件解析</li>
<li>异常处理</li>
<li>表单标签绑定</li>
</ul>
<h3 id="体系结构">体系结构</h3>
<ol>
<li>client发起一个HTTP请求, 若匹配到DispatcherServlet的请求映射路径(web.xml中指定). web容器将该请求转交给DispatcherServlet处理。</li>
<li>DispatcherServlet收到该请求后，将根据请求的信息(Url, http方法, 请求报文头, 请求参数, Cookie等)及HandlerMapping的配置找到处理请求的处理器（Handler).</li>
<li>通过HandlerAdapter对Handler进行封装， 再以统一的适配器接口调用Handler.</li>
<li>Handler完成业务逻辑的处理后将返回一个ModelAndView给DispatcherServlet, ModelAndView包括了视图逻辑名和模型数据信息.</li>
<li>ModelAndView中包含的“逻辑视图名”而非真正的视图对象, DispatcherServlet借由ViewResolver完成逻辑视图到真实视图对象的解析工作。</li>
<li>当得到真实的视图对象view后，DispatcherServlet就使用这个View对象对ModelAndView中的模型数据进行视图渲染。</li>
<li>最终client获取得到的响应消息可能是一个普通的html页面， 也可能是一个xml或json串，甚至是一张图片或一个pdf文档等不同的媒体形式。</li>
</ol>
<h3 id="配置DispatcherServlet">配置DispatcherServlet</h3>
<ol>
<li>如何截获特定的http请求，交由spring MVC框架处理？</li>
</ol>
<p>配置DispatcherServlet,截获特定的URL请求</p>
<p>在web.xml配置一个Servlet, 并通过<servlet-mapping>指定器处理的url.</servlet-mapping></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--1. 业务层和持久层的配置文件，被父Spring容器使用--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">context-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">param-value</span>&gt;</span>classpath:/conf/applicationContext.xml<span class="tag">&lt;/<span class="title">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">context-param</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">listener</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="title">listener-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">listener</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--2. 声明DispatcherServlet. 默认自动加载/WEB-INF/viewspace-servlet.xml--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">servlet</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>viewspace<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="title">servlet-class</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="title">load-on-startup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">servlet</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--3. 为Dispatcher匹配的URL模式. 指定DispatcherServlet处理所有URL以.html为后缀的HTTP请求--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>viewspace<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>*.html<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>

<p>DispatcherServlet遵循“契约优于配置”的原则，在大多数情况下， 无须精心额外的配置。</p>
<p><servlet>的<init-param>参数:</init-param></servlet></p>
<ul>
<li>namespace</li>
<li>contextConfigLocation</li>
<li>publishContent</li>
<li>publishEvents</li>
</ul>
<h2 id="注解驱动的控制器">注解驱动的控制器</h2>
<h1 id="8-_单元测试">8. 单元测试</h1>
<h2 id="概述-1">概述</h2>
<h3 id="基本概念">基本概念</h3>
<p>被测系统(System Under Test):</p>
<p>测试替身(Test Double): 使用测试替身，也可称为Mock, 减少被测对象的依赖。</p>
<p>测试夹具(Test Fixture): 在测试方法之前自动进行初始化，和资源回收的工作。 @BeforeMethod, @AfterMethod, @Test, @BeforeClass, @AfterClass</p>
<p>测试用例(Test Case)</p>
<p>测试套件(TEst Suite)</p>
<h2 id="TestNG快速进阶">TestNG快速进阶</h2>
<h3 id="异常测试">异常测试</h3>
<p>使用expetedExceptions:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> AutoNameAdviceTest {</div><div class="line">    <span class="keyword">private</span> User user;</div><div class="line">    @Test(enabled = <span class="keyword">true</span>, expectedExceptions = NullPointerException.class)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span>(){</div><div class="line">        user= <span class="keyword">new</span> User();</div><div class="line">        assertNotNull(user.getLastIp());</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="超时测试">超时测试</h3>
<p>若在指定时间完成， 就通过测试.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Test</span>(timeOut = <span class="number">10</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTimeout</span>(){</div><div class="line">    user= <span class="keyword">new</span> User();</div><div class="line">    assertNotNull(user);</div><div class="line">    <span class="keyword">try</span> {</div><div class="line">        Thread.sleep(<span class="number">11</span>);</div><div class="line">    } <span class="keyword">catch</span> (InterruptedException e) {</div><div class="line">        e.printStackTrace();</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<h3 id="参数化测试">参数化测试</h3>
<h1 id="9-_敏捷开发技术">9. 敏捷开发技术</h1>
<h1 id="10-_自己动手打造服务平台框架">10. 自己动手打造服务平台框架</h1>
<h1 id="11-_实战案例开发">11. 实战案例开发</h1>
<pre><code>      p:<span class="variable">proxyTargetClass=</span><span class="string">"true"</span>/&gt;
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yuqiao.github.io/2014/12/02/Spring3-0就这么简单/" data-id="vnksoj35p9u4whw3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/01/19/Ice协议/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Ice协议
        
      </div>
    </a>
  
  
    <a href="/2014/11/21/Programming-Erlang/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Programming Erlang</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Erlang/" style="font-size: 12.50px;">Erlang</a><a href="/tags/Ice/" style="font-size: 12.50px;">Ice</a><a href="/tags/Vim/" style="font-size: 12.50px;">Vim</a><a href="/tags/golang/" style="font-size: 12.50px;">golang</a><a href="/tags/hadoop/" style="font-size: 15.00px;">hadoop</a><a href="/tags/hbase/" style="font-size: 12.50px;">hbase</a><a href="/tags/java/" style="font-size: 17.50px;">java</a><a href="/tags/javascript/" style="font-size: 15.00px;">javascript</a><a href="/tags/node/" style="font-size: 12.50px;">node</a><a href="/tags/program/" style="font-size: 12.50px;">program</a><a href="/tags/scala/" style="font-size: 12.50px;">scala</a><a href="/tags/scalao/" style="font-size: 10.00px;">scalao</a><a href="/tags/think/" style="font-size: 12.50px;">think</a><a href="/tags/tool/" style="font-size: 15.00px;">tool</a><a href="/tags/分布式系统/" style="font-size: 12.50px;">分布式系统</a><a href="/tags/如何记笔记/" style="font-size: 12.50px;">如何记笔记</a><a href="/tags/笔记/" style="font-size: 20.00px;">笔记</a><a href="/tags/管理/" style="font-size: 12.50px;">管理</a><a href="/tags/读书笔记/" style="font-size: 12.50px;">读书笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/03/17/深入理解JVM虚拟机/">(no title)</a>
          </li>
        
          <li>
            <a href="/2015/03/15/思考，快与慢/">思考，快与慢</a>
          </li>
        
          <li>
            <a href="/2015/03/14/Go并发编程实战/">Go并发编程实战</a>
          </li>
        
          <li>
            <a href="/2015/03/12/javascript高级程序设计/">javascript高级程序设计</a>
          </li>
        
          <li>
            <a href="/2015/03/10/evernote超效率数字笔记术/">evernote超效率数字笔记术</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Peter Yu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">存档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
